<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>Link Properties</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex, nofollow" />
	<script src="../../../dialog/common/fck_dialog_common.js" type="text/javascript"></script>
	<script type="text/javascript">
var dialog	= window.parent ;
var oEditor = dialog.InnerDialogLoaded() ;

var FCK			= oEditor.FCK ;
var FCKLang		= oEditor.FCKLang ;
var FCKConfig	= oEditor.FCKConfig ;
var FCKRegexLib	= oEditor.FCKRegexLib ;
var FCKTools	= oEditor.FCKTools ;

// Overall classification
var MODE;
var EXISTING = 1;
var NEW_SELECTION = 2;
var NEW_NO_SELECTION = 3;

// In detail classification for EXISTING
var TYPE;
var INTERNAL = 4;
var EXTERNAL = 5;

var link = dialog.Selection.GetSelection().MoveToAncestorNode('A');
var refid = link.getAttribute('refid');

// Determine link MODE and TYPE. Also if it's existing link then expand editor selection.
if(link) {
	FCK.Selection.SelectNode(link);
	var data = FCK.wysiwygData[link.getAttribute('refid')];

	MODE = EXISTING;
	if(data.type == 'internal link') {
		TYPE = INTERNAL;
	} else {
		TYPE = EXTERNAL;
	}

} else {

	var selection = FCK.Selection.GetSelection();
	var selectionText = selection.type ? selection.createRange().text : selection.toString();
	if(selectionText != "") {
		MODE = NEW_SELECTION;
	} else {
		MODE = NEW_NO_SELECTION;
	}

}

dialog.AddTab('internal_link', 'Internal link');
dialog.AddTab('external_link', 'External link');

function OnDialogTabChange(tabCode) {
	ShowE('divInternalLink', (tabCode == 'internal_link'));
	ShowE('divExternalLink', (tabCode == 'external_link'));

	dialog.SetAutoSize( true ) ;
}

window.onload = function() {

	if(MODE == EXISTING) {

		if(TYPE == INTERNAL) {

			dialog.SetSelectedTab('internal_link');

			GetE("internal_article_name").value = FCK.wysiwygData[refid].href;

			if(GetE("internal_article_name").value != link.innerHTML) {
				GetE("internal_link_text").value = link.innerHTML;
			}

		} else if(TYPE == EXTERNAL) {

			dialog.SetSelectedTab('external_link');

			GetE("external_url").value = FCK.wysiwygData[refid].href;

			if(link.innerHTML == "[link]") {
				GetE("external_link_text").disabled = true;
				GetE("external_unlabeled_link").checked = true;
			} else {
				if(GetE("external_url").value != link.innerHTML) {
					GetE("external_link_text").value = link.innerHTML;
				}
			}

		}

	} else { // NEW LINKS

		dialog.SetSelectedTab('internal_link');

		if(MODE == NEW_SELECTION) {
			GetE("internal_article_name").value = selectionText;
		}

	}

	window.parent.SetOkButton(true);
	window.parent.SetAutoSize(true);
}

function Ok() {
/*
	oEditor.FCKUndo.SaveUndoStep();

	var linkText = GetE("linkText").value;
	var articleName = GetE("articleName").value;
	var trial = "";

	if(LINK_MODE == EXISTING) {

		var aLinks = [oLink];

	} else {

		if(LINK_MODE == NEW_SELECTION) {

			var aLinks = oEditor.FCK.CreateLink(articleName, true);

		} else if(LINK_MODE == NEW_NO_SELECTION) {

			var aLinks = [oEditor.FCK.InsertElement('a')];

		}

	}

	if(linkText == "" && articleName != "") {
		linkText = articleName;
	}
	if(linkText != "" && articleName == "") {
		articleName = linkText;
	}

	aLinks[0].innerHTML = linkText;
	aLinks[0].href = "";

	if(linkText == articleName) {
		linkText = "";
	}

	if(LINK_MODE != EXISTING) {
		var refid = FCK.wysiwygData.length;
		aLinks[0].setAttribute("refid", refid);
		FCK.wysiwygData[refid] = {type:"internal link"};
	} else {
		var refid = aLinks[0].getAttribute('refid');
	}

	FCK.wysiwygData[refid].href = articleName;
	FCK.wysiwygData[refid].description = linkText;
	FCK.wysiwygData[refid].trial = trial;
*/
	return true;
}
	</script>
</head>
	<body scroll="no" style="OVERFLOW: hidden">
		<div id="divInternalLink" style="DISPLAY: none">

			<span>Article name:</span>
			<br />
			<input id="internal_article_name" style="WIDTH: 100%" type="text" />

			<br /><br />

			<span>Link text (if different than Article name):</span>
			<br />
			<input id="internal_link_text" style="WIDTH: 100%" type="text" />

		</div>

		<div id="divExternalLink" style="DISPLAY: none">

			<span>URL:</span>
			<br />
			<input id="external_url" style="WIDTH: 100%" type="text" />

			<br /><br />

			<span>Link text:</span>
			<br />
			<input id="external_link_text" style="WIDTH: 100%" type="text" />

			<br /><br />

			<input id="external_unlabeled_link" type="checkbox" />
			<label for="external_unlabeled_link">Unlabeled link</label>

		</div>

	</body>
</html>