<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<title>Link Properties</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex, nofollow" />
	<script src="../../../dialog/common/fck_dialog_common.js" type="text/javascript"></script>
	<script type="text/javascript">
var dialog	= window.parent ;
var oEditor = dialog.InnerDialogLoaded() ;

var FCK			= oEditor.FCK ;
var FCKLang		= oEditor.FCKLang ;
var FCKConfig	= oEditor.FCKConfig ;
var FCKRegexLib	= oEditor.FCKRegexLib ;
var FCKTools	= oEditor.FCKTools ;

dialog.AddTab( 'internal_link', 'Internal link' ) ;

var EXISTING = 1;
var NEW_SELECTION = 2;
var NEW_NO_SELECTION = 3;

var LINK_MODE;

var oLink = dialog.Selection.GetSelection().MoveToAncestorNode('A');
if(oLink) {
	FCK.Selection.SelectNode(oLink);
	var refid = oLink.getAttribute('refid');
	LINK_MODE = EXISTING;
} else {
	var oSelection = FCK.Selection.GetSelection();
	var oSelectionText = oSelection.type ? oSelection.createRange().text : oSelection.toString();
	if(oSelectionText != "") {
		LINK_MODE = NEW_SELECTION;
	} else {
		LINK_MODE = NEW_NO_SELECTION;
	}
}

window.onload = function() {
	GetE("divInternalLink").style.display = "";

	if(LINK_MODE == EXISTING) {
		GetE("articleName").value = FCK.wysiwygData[refid].href;
		if(GetE("articleName").value != oLink.innerHTML) {
			GetE("linkText").value = oLink.innerHTML;
		}
	} else if(LINK_MODE == NEW_SELECTION) {
		GetE("articleName").value = oSelectionText;
		//GetE("linkText").value = oSelectionText;
	}

	window.parent.SetOkButton(true);
	window.parent.SetAutoSize(true);
}

function Ok() {
	oEditor.FCKUndo.SaveUndoStep();

	var linkText = GetE("linkText").value;
	var articleName = GetE("articleName").value;
	var trial = "";

	if(LINK_MODE == EXISTING) {

		var aLinks = [oLink];

	} else {

		if(LINK_MODE == NEW_SELECTION) {

			var aLinks = oEditor.FCK.CreateLink(articleName, true);

		} else if(LINK_MODE == NEW_NO_SELECTION) {

			var aLinks = [oEditor.FCK.InsertElement('a')];

		}

	}

	if(linkText == "" && articleName != "") {
		linkText = articleName;
	}
	if(linkText != "" && articleName == "") {
		articleName = linkText;
	}

	if(linkText == articleName) {
		linkText = "";
	}

	aLinks[0].innerHTML = linkText;
	aLinks[0].href = "";

	if(LINK_MODE != EXISTING) {
		var refid = FCK.wysiwygData.length;
		aLinks[0].setAttribute("refid", refid);
		FCK.wysiwygData[refid] = {type:"internal link"};
	} else {
		var refid = aLinks[0].getAttribute('refid');
	}

	FCK.wysiwygData[refid].href = articleName;
	FCK.wysiwygData[refid].description = linkText;
	FCK.wysiwygData[refid].trial = trial;

	return true;
}
	</script>
</head>
	<body scroll="no" style="OVERFLOW: hidden">
		<div id="divInternalLink" style="DISPLAY: none">
			<span>Link text:</span>
			<br />
			<input id="linkText" style="WIDTH: 100%" type="text" />
			<br /><br />
			<span>Article name:</span>
			<br />
			<input id="articleName" style="WIDTH: 100%" type="text" />
		</div>
	</body>
</html>